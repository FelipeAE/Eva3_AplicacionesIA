{% extends 'base.html' %}
{% block content %}
<div class="container mt-4">
  <h3>‚öôÔ∏è Administraci√≥n de Contextos de Prompt</h3>
  
  <!-- Mostrar mensajes de Django -->
  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags|default:'info' }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}

  <form method="post" class="mb-4">
    {% csrf_token %}
    <h5>‚ûï Crear nuevo contexto</h5>
    <input type="text" name="nombre" class="form-control mb-2" placeholder="Nombre del contexto">
    <textarea name="prompt_sistema" class="form-control mb-2" rows="5" placeholder="Texto del prompt..."></textarea>
    <button type="submit" name="crear" class="btn btn-success">Crear</button>
  </form>

  {% if contextos %}
    <h5>üìã Contextos existentes</h5>
    <table class="table table-hover">
      <thead>
        <tr>
          <th style="width: 30%;">Contexto</th>
          <th style="width: 15%;">Estado</th>
          <th style="width: 25%;">Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for c in contextos %}
          <tr style="vertical-align: top;">
            <td class="py-3">
              <div class="mb-2">
                <strong class="fs-6">{{ c.nombre }}</strong>
                {% if c.activo %}
                  <span class="badge bg-success ms-2">Activo</span>
                {% endif %}
              </div>
              <div class="text-muted border-start border-3 border-info ps-3 mt-2">
                <small>
                  <strong class="text-dark">¬øQu√© hace este contexto?</strong><br>
                  <em>{{ c.prompt_sistema }}</em>
                </small>
              </div>
            </td>
            <td class="py-3">
              {% if c.activo %}
                <span class="text-success">‚úÖ Activo</span>
              {% else %}
                <span class="text-secondary">‚Äî Inactivo</span>
              {% endif %}
            </td>
            <td class="py-3">
              {% if not c.activo %}
                <form method="post" style="display:inline;">
                  {% csrf_token %}
                  <button name="activar" value="{{ c.id }}" class="btn btn-sm btn-primary">Activar</button>
                </form>
              {% else %}
                <form method="post" style="display:inline;">
                  {% csrf_token %}
                  <button name="desactivar" value="{{ c.id }}" class="btn btn-sm btn-warning">Desactivar</button>
                </form>
              {% endif %}
              <form method="post" style="display:inline;">
                {% csrf_token %}
                <button name="eliminar" value="{{ c.id }}" class="btn btn-sm btn-danger">Eliminar</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p class="text-muted">No hay contextos definidos.</p>
  {% endif %}
</div>
{% endblock %}
